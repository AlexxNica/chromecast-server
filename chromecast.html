<html>
  <head>
    <title>Mozilla Tab Mirror</title>
    <script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
    <style>
      body {
      color: white;
      background-color: black;
      }
    </style>
    <script src="adapter.js"></script>
    <script src="player.js"></script>
    <link rel='stylesheet' href="player.css"></link>
  </head>
  <body>
    <video id="video" autoplay="true"></video><br/>
    <script>
var divs = {
  remote_video : document.getElementById("video") ,
};

var client = new CallingClient(divs);

window.onload = function() {
  try {
    // Uncomment to set logger level to DEBUG
    //cast.receiver.logger.setLevelValue(cast.receiver.LoggerLevel.DEBUG);
    window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
    window.castReceiverManager.onSenderConnected = function(event) {
      log("sender connected: " + JSON.stringify(event));

    }
    window.castReceiverManager.onReady = function(event) {
      log("on ready");
      try {
        log("onReady: " +  JSON.stringify(event));
      } catch(e) {
        log(e);
      }
    }
    window.messageBus = window.castReceiverManager.getCastMessageBus('urn:x-cast:org.mozilla.mirror');
    log("bus: " + messageBus);
    window.messageBus.onMessage = function(event) {
      log("onMessage called with: " + event.data);
      client.processEvent(event.senderId, event.data);
    }

    var appConfig = new cast.receiver.CastReceiverManager.Config();
    appConfig.statusText = "let's cast";
    appConfig.maxInactvity = 6000;
    window.castReceiverManager.start(appConfig);
  } catch(e) {
    log(e);
  }
}
    </script>
  </body>
</html>
